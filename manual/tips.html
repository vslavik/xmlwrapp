<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>xmlwrapp: Tips, Tricks and Warnings</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">xmlwrapp
   </div>
   <div id="projectbrief">Lightweight C++ XML parsing library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">xmlwrapp</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Tips, Tricks and Warnings</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="tips_lifetime"></a>
Iterators and Object Lifetimes</h1>
<p>Because of the way xmlwrapp is implemented, you must be careful with pointers and references that you take from xmlwrapp iterators. The pointers and references will only be valid as long as the iterator is valid.</p>
<p>From the xmlwrapp-users mailing list:</p>
<pre>
From: Peter Jones <a href="#" onclick="location.href='mai'+'lto:'+'xml'+'wr'+'app'+'@p'+'mad'+'e.'+'org'; return false;">xmlwr<span class="obfuscator">.nosp@m.</span>app@<span class="obfuscator">.nosp@m.</span>pmade<span class="obfuscator">.nosp@m.</span>.org</a>
Subject: Re: [xmlwrapp-users] Potential bug in <a class="el" href="classxml_1_1node_1_1iterator.html" title="The xml::node::iterator provides a way to access children nodes similar to a standard C++ container.">xml::node::iterator</a> dereferencing?
Date: Fri, 21 Mar 2003 07:47:05 -0800

It does seem strange on the surface that <a class="el" href="classxml_1_1node_1_1iterator.html" title="The xml::node::iterator provides a way to access children nodes similar to a standard C++ container.">xml::node::iterator</a> has an
<a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> as a member variable. However, <a class="el" href="classxml_1_1node_1_1iterator.html" title="The xml::node::iterator provides a way to access children nodes similar to a standard C++ container.">xml::node::iterator</a> is really a
shell class that uses the pimpl idiom to contain another class, and that
class is what holds the <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a>.

I would much prefer to emulate the standard containers in this respect,
and I would love to hear any suggestions on how this might be done.

Let me explain the problem as I see it, and maybe you and others can
point me in the right direction.

<a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> is somewhat like a std::list. From the outside it looks as if
<a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> is a container for other <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> objects, however, this is
not true. The objects that <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> contains are really pointers to
libxml2 data structures.

I decided early on that, unlike other libxml2 C++ libraries, xmlwrapp
should not try to duplicate the XML tree using C++ containers, but
instead emulate that container interface and adapt it to the libxml2
function calls.

It is quite easy for the standard containers to return a valid
pointer/reference to their contained objects since those objects are
already in memory, and will be around until the container goes away or
an operation is preformed on that container that would invalidate those
pointers/references.

But, <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> is keeping pointers to xmlNode structs, not <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a>
classes. This means that the xml::node::iterators could return pointers
to xmlNode structs that out live the iterator, but that is not what
users would expect.

Currently, the <a class="el" href="classxml_1_1node_1_1iterator.html" title="The xml::node::iterator provides a way to access children nodes similar to a standard C++ container.">xml::node::iterator</a> will use its <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> member
variable as a way to pretend that <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> objects are containers for
other <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> objects. This is why the lifetime of the <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> is
limited to the lifetime of the <a class="el" href="classxml_1_1node_1_1iterator.html" title="The xml::node::iterator provides a way to access children nodes similar to a standard C++ container.">xml::node::iterator</a>.
</pre><h1><a class="anchor" id="tips_debugging"></a>
Debugging</h1>
<p>Any <a class="el" href="classxml_1_1node.html" title="The xml::node class is used to hold information about one XML node.">xml::node</a> object can be easily examined by dumping it to a string using its <a class="el" href="classxml_1_1node.html#a3f6a922582c1a85cd886a694e2ca6c8f" title="Convert the node and all its children into XML text and return the string containing them.">xml::node::node_to_string()</a> method or by outputting it into any standard stream: </p><div class="fragment"><div class="line"><a class="code hl_class" href="classxml_1_1node.html">xml::node</a> n = ...;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Contents of the node: &quot;</span> &lt;&lt; n;</div>
<div class="ttc" id="aclassxml_1_1node_html"><div class="ttname"><a href="classxml_1_1node.html">xml::node</a></div><div class="ttdoc">The xml::node class is used to hold information about one XML node.</div><div class="ttdef"><b>Definition</b> node.h:92</div></div>
</div><!-- fragment --><p>Notice that the node_to_string() function can even be called from a debugger to see the contents of the node during a debugging session. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 5 2025 21:15:11 for xmlwrapp by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
